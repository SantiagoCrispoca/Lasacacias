<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pedidos Anteriores - FloristerÃ­a Las Acacias</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .pedido {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }

    .pedido img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      margin-right: 15px;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <button class="cart-button">ðŸ›’</button>
    <button class="login-button">ðŸ‘¤</button>
    <div class="logo">
      <a href="index.html">
        <img src="imagenes/logo2.jpg" alt="Logo de FloristerÃ­a Las Acacias" />
      </a>
    </div>
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Buscar productos..." />
      <div id="search-results" class="search-results"></div>
    </div>
  </header>

  <div class="container">
    <h1>Tus Pedidos Anteriores</h1>
    <div id="pedidos-container"></div>
  </div>

  <!-- Footer igual al index.html -->
  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h3>ContÃ¡ctanos</h3>
        <p><i class="fab fa-whatsapp"></i> +57 321 9694834</p>
        <p>
          <i class="fa-solid fa-envelope"></i> lasacaciasfloristeria@gmail.com
        </p>
      </div>

      <!--Formas de pago-->
      <div class="footer-section">
        <h3>Formas de pago</h3>
        <img src="imagenes/NequiLogo.png" alt="Nequi" style="width: 60px" />
      </div>

      <!--Redes-->
      <div class="footer-section">
        <h3>Redes</h3>
        <p>
          <a href="https://www.facebook.com/share/1Ahi9w2jai/" target="_blank" rel="noopener noreferrer">
            <img src="imagenes/Facebook.png" alt="Facebook" class="social-btn" />
          </a>
          <a href="https://www.instagram.com/lasacaciasflores/" target="_blank" rel="noopener noreferrer">
            <img src="imagenes/instagram.png" alt="Instagram" class="social-btn" />
          </a>
        </p>
      </div>
    </div>
    <div class="footer-copy">
      <p>Â© 2025 FloristerÃ­a Las Acacias</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
    if (sessionStorage.getItem('user_role') !== 'user') {
        return window.location.href = 'index.html';
    }

    const correoUsuario = sessionStorage.getItem('user_email');
    const container = document.getElementById('pedidos-container');

    const params = new URLSearchParams();
    params.append('correo', correoUsuario);

    try {
        const response = await fetch('php/obtener_pedidos.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: params.toString()
        });

        const data = await response.json();
        if (!data.success) throw new Error(data.error);

        if (data.pedidos.length === 0) {
            container.innerHTML = '<p>No tienes pedidos anteriores aÃºn.</p>';
            return;
        }

        let pedidosMostrados = 0;
        const lote = 3;

        const contenedorPedidos = document.createElement("div");
        const botonMas = document.createElement("button");

        botonMas.textContent = "Mostrar mÃ¡s pedidos";
        botonMas.id = "btn-mas";
        botonMas.style.cssText = `
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #8cbaa3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        `;

        const mostrarPedidos = () => {
            const fragment = document.createDocumentFragment();

            for (let i = pedidosMostrados; i < pedidosMostrados + lote && i < data.pedidos.length; i++) {
                const pedido = data.pedidos[i];
                const items = JSON.parse(pedido.items);

                const div = document.createElement("div");
                div.className = "pedido";
                div.style.position = "relative";
                div.innerHTML = `
                    <h3>Pedido del ${new Date(pedido.fecha).toLocaleDateString()}</h3>
                    <p><strong>Estado:</strong> ${pedido.estado}</p>
                    ${items.map(item => `
                        <div style="display: flex; align-items: center; margin: 10px 0;">
                            <img src="${item.imagen}" alt="${item.nombre}" style="width:80px; height:80px; object-fit:cover; margin-right:10px;">
                            <div>
                                <p>${item.nombre} x${item.cantidad}</p>
                                ${item.mensaje ? `<p>Mensaje: ${item.mensaje}</p>` : ''}
                                ${item.accesorio !== 'ninguno' ? `<p>Accesorio: ${item.accesorio}</p>` : ''}
                            </div>
                        </div>
                    `).join('')}
                    <p><strong>Total: $${parseInt(pedido.total).toLocaleString()}</strong></p>
                `;

                fragment.appendChild(div);
            }

            contenedorPedidos.appendChild(fragment);
            pedidosMostrados += lote;

            if (pedidosMostrados >= data.pedidos.length) {
                botonMas.remove();
            }
        };

        mostrarPedidos();
        botonMas.addEventListener("click", mostrarPedidos);

        container.appendChild(contenedorPedidos);
        container.appendChild(botonMas);

    } catch (err) {
        console.error(err);
        container.innerHTML = `<p>Error al cargar tus pedidos: ${err.message}</p>`;
    }
});
  </script>

</body>

</html>