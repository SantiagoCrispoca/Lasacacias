<!DOCTYPE html>
<html lang="es">
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <meta charset="UTF-8" />
    <meta name="author" content="David Santiago Crispoca Taborda, Sebastian Guzman Castiblanco, Yoann Esteban Jacome Garcia, Maria Alejandra Suarez Cuesta.">
    <meta name="description" content="Proyecto Tecnologías del internet MUL B 2025-01, pagina web creada con HTML, CSS Y JavaScript.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Productos - Floristería Las Acacias</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <!-- Header -->
<header class="header">
  <button class="cart-button">🛒</button>
  <button class="login-button">👤</button> <!-- Botón añadido -->
  <div class="logo">
    <a href="index.html">
      <img src="imagenes/logo2.jpg" alt="Logo de Floristería Las Acacias"/>
    </a>
  </div>
  <div class="search-box">
    <input type="text" id="search-input" placeholder="Buscar productos..."/>
    <div id="search-results" class="search-results"></div>
  </div>
</header>
    <!-- Navegación -->
<nav class="navbar">
  <ul>
    <li><a href="index.html">Inicio</a></li>
    <li><a href="productos.html">Productos</a></li>
    <li><a href="quienes-somos.html">¿Quiénes Somos?</a></li>
    <li><a href="preguntas-frecuentes.html">Preguntas Frecuentes</a></li>
    <li id="dynamic-nav-item" style="display: none;">
      <a id="nav-link" href="#"></a>
    </li>
  </ul>
</nav>

    <!-- Sección de Manojos -->
    <section class="productos-section">
      <h2>Manojos</h2>
      <div class="productos-grid">
        <div class="flor-clickeable">
          <img src="imagenes/manojo-1.jpeg" alt="Manojo 1" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-2.jpeg" alt="Manojo 2" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-3.jpeg" alt="Manojo 3" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-4.jpeg" alt="Manojo 4" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-5.jpeg" alt="Manojo 5" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-6.jpeg" alt="Manojo 6" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-7.jpg" alt="Manojo 7" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/manojo-8.jpg" alt="Manojo 8" />
        </div>
      </div>
    </section>

    <!-- Sección de Ramos -->
    <section class="productos-section">
      <h2>Ramos</h2>
      <div class="productos-grid">
        <div class="flor-clickeable">
          <img src="imagenes/ramo-1.jpeg" alt="Ramo 1" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-2.png" alt="Ramo 2" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-3.jpg" alt="Ramo 3" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-4.jpg" alt="Ramo 4" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-5.jpg" alt="Ramo 5" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-6.jpg" alt="Ramo 6" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-7.jpg" alt="Ramo 7" />
        </div>
        <div class="flor-clickeable">
          <img src="imagenes/ramo-8.jpg" alt="Ramo 8" />
        </div>
      </div>
    </section>

    <!--Modales de flores-->
    <div id="modal" class="modal">
      <div class="modal-contenido">
        <span class="cerrar-modal">&times;</span>

        <h2 id="modal-titulo">Nombre de la Flor</h2>
        <img id="modal-imagen" src="" alt="Flor" class="modal-imagen" />
        <p id="modal-descripcion">Descripción de la flor.</p>
        <p id="modal-precio">Precio: $XX.XXX</p>

        <div class="cantidad-agregar">
          <label for="cantidad">Cantidad:</label>
          <input type="number" id="cantidad" min="1" value="1" />
          <button id="agregar-carrito">Agregar al carrito</button>
        </div>

        <div class="mensaje">
          <label for="mensaje-flor">Mensaje para la flor:</label>
          <textarea
            id="mensaje-flor"
            rows="4"
            placeholder="Escribe tu mensaje aquí..."
          ></textarea>
        </div>

        <div class="accesorios">
          <label>Accesorios:</label>
          <select id="accesorios">
            <option value="ninguno">Ninguno</option>
            <option value="oso">Oso de peluche (+$10.000)</option>
            <option value="globo">Globo temático (+$5.000)</option>
            <option value="chocolate">Chocolate (+$7.000)</option>
            <option value="corona">Corona (+$8.000)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Carrito de compras -->
    <div id="carrito-modal" class="carrito-modal">
      <div class="carrito-header">
        <h2>Tu Carrito</h2>
        <span class="cerrar-carrito">&times;</span>
      </div>
      <div id="carrito-items"></div>
      <div class="carrito-total">Total: $<span id="carrito-total">0</span></div>
      <div class="carrito-botones">
        <button class="vaciar-carrito" id="vaciar-carrito">
          Vaciar Carrito
        </button>
        <a href="pagos.html" class="pagar-carrito">Ir a pagar</a>
      </div>
    </div>

    <div class="confirmacion-agregado" id="confirmacion-agregado">
      Producto añadido al carrito!
    </div>

    <div id="login-modal" class="modal">
      <div class="modal-contenido">
        <span class="cerrar-login">&times;</span>
        <div class="login-tabs">
          <button class="tab-link active" data-tab="login">Iniciar Sesión</button>
          <button class="tab-link" data-tab="registro">Registrarse</button>
        </div>

        <!-- Formulario de Login -->
        <div id="login" class="tab-content active">
          <form id="login-form">
            <div class="form-group">
              <label for="username">Correo:</label>
              <input type="text" id="correo" name="correo" required> 
            </div>

            <div class="form-group">
              <label for="password">Contraseña:</label>
              <input type="password" id="password" name="password" required> 
            </div>

            <button type="submit" class="login-submit">Ingresar</button>
          </form>
        </div>

        <!-- Formulario de Registro -->
        <div id="registro" class="tab-content">
          <form id="registro-form">
            <div class="form-group">
              <label for="reg-username">Nombre:</label>
              <input type="text" id="reg-username" required>
            </div>

            <div class="form-group">
              <label for="reg-password">Contraseña:</label>
              <input type="password" id="reg-password" required>
            </div>

            <div class="form-group">
              <label for="reg-email">Correo:</label>
              <input type="email" id="reg-email" required>
            </div>
            <button type="submit" class="login-submit">Registrarse</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Footer -->
   <footer>
  <div class="footer-container">
    <div class="footer-section">
      <h3>Contáctanos</h3>
      <p><i class="fab fa-whatsapp"></i> +57 321 9694834</p>
      <p><i class="fa-solid fa-envelope"></i> lasacaciasfloristeria@gmail.com</p>
    </div>
    <div class="footer-section">
      <h3>Formas de pago</h3>
      <img src="imagenes/NequiLogo.png" alt="Nequi" style="width: 60px" />
    </div>
    <div class="footer-section">
      <h3>Redes</h3>
      <p>
        <a href="https://www.facebook.com/share/1Ahi9w2jai/" target="_blank" rel="noopener noreferrer">
          <img src="imagenes/Facebook.png" alt="Facebook" class="social-btn" />
        </a>
        <a href="https://www.instagram.com/lasacaciasflores/" target="_blank" rel="noopener noreferrer">
          <img src="imagenes/instagram.png" alt="Instagram" class="social-btn" />
        </a>
      </p>
    </div>
  </div>
  <div class="footer-copy">
    <p>© 2025 Floristería Las Acacias</p>
  </div>
</footer>


    <!--Script interno-->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // -------------------- COOKIES --------------------
        const cookieNotice = document.getElementById("cookie-notice");
        const acceptCookiesButton = document.getElementById("accept-cookies");
        if (acceptCookiesButton) {
          acceptCookiesButton.addEventListener("click", () => {
            cookieNotice.style.display = "none";
            localStorage.setItem("cookiesAccepted", "true");
          });
          if (localStorage.getItem("cookiesAccepted") === "true") {
            cookieNotice.style.display = "none";
          }
        }

        // -------------------- DATOS FLORES --------------------
        const datosFlores = [
          // Manojos
          {
            nombre: "Manojo Rosas Rojas",
            imagen: "imagenes/manojo-1.jpeg",
            descripcion:
              "Un hermoso manojo de Rosas rojas, perfecto para cualquier ocasión.",
            precio: "$60.000",
          },
          {
            nombre: "Manojo Variado",
            imagen: "imagenes/manojo-2.jpeg",
            descripcion:
              "Manojo de Rosas variadas, ideal para expresar amor y pureza.",
            precio: "$30.000",
          },
          {
            nombre: "Manojo De Girasoles",
            imagen: "imagenes/manojo-3.jpeg",
            descripcion: "Manojo de girasoles, lleno de energía y alegría.",
            precio: "$40.000",
          },
          {
            nombre: "Manojo Variado",
            imagen: "imagenes/manojo-4.jpeg",
            descripcion: "Manojo de liliums, elegante y sofisticado.",
            precio: "$25.000",
          },
          {
            nombre: "Manojo Variado rosado",
            imagen: "imagenes/manojo-5.jpeg",
            descripcion: "Manojo de margaritas, fresco y juvenil.",
            precio: "$25.000",
          },
          {
            nombre: "Manojo Variado amarillo",
            imagen: "imagenes/manojo-6.jpeg",
            descripcion: "Manojo de claveles, clásico y duradero.",
            precio: "$30.000",
          },
          {
            nombre: "Manojo Princesa",
            imagen: "imagenes/manojo-7.jpg",
            descripcion:
              "Manojo de rosas rojas, llamativo, perfecto para las princesas de la casa.",
            precio: "$120.000",
          },
          {
            nombre: "Manojo Girasoles",
            imagen: "imagenes/manojo-8.jpg",
            descripcion: "Manojo de girasoles, natural y encantador.",
            precio: "$40.000",
          },
          // Ramos
          {
            nombre: "Ramo Rosas Rojas",
            imagen: "imagenes/ramo-1.jpeg",
            descripcion: "Ramo de rosas rojas, el clásico símbolo del amor.",
            precio: "$80.000",
          },
          {
            nombre: "Ramo Rosas Rojas",
            imagen: "imagenes/ramo-2.png",
            descripcion:
              "Ramo de rosas rojas en base de vidrio, perfecto para alegrar cualquier espacio.",
            precio: "$40.000",
          },
          {
            nombre: "Ramo Variado Rosado",
            imagen: "imagenes/ramo-3.jpg",
            descripcion: "Ramo margaritas y girasoles, elegante y sofisticado.",
            precio: "$80.000",
          },
          {
            nombre: "Ramo Girasoles y Rosas",
            imagen: "imagenes/ramo-4.jpg",
            descripcion:
              "Ramo de girasoles y rosas rojas, lleno de energía y frescura.",
            precio: "$70.000",
          },
          {
            nombre: "Ramo Girasoles",
            imagen: "imagenes/ramo-5.jpg",
            descripcion:
              "Ramo de girasoles en base de vidrio, exótico y llamativo.",
            precio: "$30.000",
          },
          {
            nombre: "Ramo Variado",
            imagen: "imagenes/ramo-6.jpg",
            descripcion:
              "Ramo de girasoles y flores silvestres, natural y encantador.",
            precio: "$80.000",
          },
          {
            nombre: "Ramo Rosas Rosadas",
            imagen: "imagenes/ramo-7.jpg",
            descripcion:
              "Ramo de rosas rosadas, ideal para bodas y eventos especiales.",
            precio: "$50.000",
          },
          {
            nombre: "Ramo Exotico",
            imagen: "imagenes/ramo-8.jpg",
            descripcion:
              "Ramo de flores variadas, perfecto para cualquier ocasión.",
            precio: "$60.000",
          },
        ];

        const productos = [
          // Manojos
          {
            id: "manojo-1",
            nombre: "Manojo de Lavanda",
            imagen: "imagenes/manojo-1.jpeg",
          },
          {
            id: "manojo-2",
            nombre: "Manojo de Romero",
            imagen: "imagenes/manojo-2.jpeg",
          },
          {
            id: "manojo-3",
            nombre: "Manojo de Eucalipto",
            imagen: "imagenes/manojo-3.jpeg",
          },
          {
            id: "manojo-4",
            nombre: "Manojo de Hierbabuena",
            imagen: "imagenes/manojo-4.jpeg",
          },
          {
            id: "manojo-5",
            nombre: "Manojo de Albahaca",
            imagen: "imagenes/manojo-5.jpeg",
          },
          {
            id: "manojo-6",
            nombre: "Manojo de Cilantro",
            imagen: "imagenes/manojo-6.jpeg",
          },
          {
            id: "manojo-7",
            nombre: "Manojo de Tomillo",
            imagen: "imagenes/manojo-7.jpg",
          },
          {
            id: "manojo-8",
            nombre: "Manojo de Menta",
            imagen: "imagenes/manojo-8.jpg",
          },

          // Ramos
          {
            id: "ramo-1",
            nombre: "Ramo de Rosas Clásicas",
            imagen: "imagenes/ramo-1.jpeg",
          },
          {
            id: "ramo-2",
            nombre: "Ramo de Tulipanes",
            imagen: "imagenes/ramo-2.png",
          },
          {
            id: "ramo-3",
            nombre: "Ramo de Lirios",
            imagen: "imagenes/ramo-3.jpg",
          },
          {
            id: "ramo-4",
            nombre: "Ramo de Girasoles",
            imagen: "imagenes/ramo-4.jpg",
          },
          {
            id: "ramo-5",
            nombre: "Ramo de Margaritas",
            imagen: "imagenes/ramo-5.jpg",
          },
          {
            id: "ramo-6",
            nombre: "Ramo de Claveles",
            imagen: "imagenes/ramo-6.jpg",
          },
          {
            id: "ramo-7",
            nombre: "Ramo de Peonias",
            imagen: "imagenes/ramo-7.jpg",
          },
          {
            id: "ramo-8",
            nombre: "Ramo de Orquídeas",
            imagen: "imagenes/ramo-8.jpg",
          },
        ];

        //Nombre en blur
        document.querySelectorAll(".flor-clickeable").forEach((flor) => {
    const img = flor.querySelector("img");
    const imgSrc = img.getAttribute("src");
    const florData = datosFlores.find(item => item.imagen === imgSrc);

    if (florData) {
        const contenedorInfo = document.createElement("div");
        contenedorInfo.className = "nombre-flor";

        const nombreElement = document.createElement("div");
        nombreElement.className = "nombre-flor-texto";
        nombreElement.textContent = florData.nombre;

        const precioElement = document.createElement("div");
        precioElement.className = "precio-flor-texto";
        precioElement.textContent = florData.precio;

        contenedorInfo.appendChild(nombreElement);
        contenedorInfo.appendChild(precioElement);
        flor.appendChild(contenedorInfo);
    }
});

        // -------------------- MODAL --------------------
        const modal = document.getElementById("modal");
        const modalTitulo = document.getElementById("modal-titulo");
        const modalImagen = document.getElementById("modal-imagen");
        const modalDescripcion = document.getElementById("modal-descripcion");
        const modalPrecio = document.getElementById("modal-precio");
        const cerrarModal = document.querySelector(".cerrar-modal");
        let currentFlowerIndex = 0;

        document.querySelectorAll(".flor-clickeable").forEach((flor) => {
          flor.addEventListener("click", () => {
            const imgSrc = flor.querySelector("img").getAttribute("src");
            const producto = datosFlores.find((item) => item.imagen === imgSrc);

            if (producto) {
              currentFlowerIndex = datosFlores.indexOf(producto);
              abrirModal(producto);
            }
          });
        });

        function abrirModal(producto) {
          modalTitulo.textContent = producto.nombre;
          modalImagen.src = producto.imagen;
          modalDescripcion.textContent = producto.descripcion;
          modalPrecio.textContent = `Precio: ${producto.precio}`;
          modal.style.display = "flex";
        }

        cerrarModal.addEventListener(
          "click",
          () => (modal.style.display = "none")
        );
        window.addEventListener(
          "click",
          (e) => e.target === modal && (modal.style.display = "none")
        );

        // -------------------- BÚSQUEDA --------------------
        const searchInput = document.getElementById("search-input");
        const searchResults = document.getElementById("search-results");

        searchInput.addEventListener("input", function () {
          const query = this.value.trim().toLowerCase();
          searchResults.innerHTML = "";

          if (query) {
            const filtrados = productos
              .filter(
                (p) =>
                  p.nombre.toLowerCase().includes(query) ||
                  p.id.toLowerCase().includes(query)
              )
              .map((p) => ({
                ...p,
                data: datosFlores.find((f) => f.imagen === p.imagen),
              }));

            mostrarResultados(filtrados);
          } else {
            searchResults.style.display = "none";
          }
        });

        function mostrarResultados(resultados) {
            searchResults.innerHTML = resultados.map(p => {
        const dataIndex = datosFlores.findIndex(f => f.imagen === p.imagen);
        return `
            <div class="resultado-busqueda" data-index="${dataIndex}">
              <img src="${p.imagen}" alt="${p.nombre}" width="40">
              <span>${p.nombre}</span>
          </div>`;
      }).join("");

          searchResults.style.display = resultados.length ? "block" : "none";
          searchResults
            .querySelectorAll(".resultado-busqueda")
            document.querySelectorAll(".resultado-busqueda").forEach(item => {
        item.addEventListener("click", () => {
          currentFlowerIndex = parseInt(item.dataset.index);
          abrirModal(datosFlores[currentFlowerIndex]);
            });
        });
        }

        document.getElementById("btn-pagar")?.addEventListener("click", () => {
        const correo = sessionStorage.getItem("user_email");
        if (!correo) {
          alert("Debes iniciar sesión para pagar.");
          return;
        }
        window.location.href = "pagos.html";
      });

// -------------------- LOGIN --------------------
const loginButton = document.querySelector(".login-button");
const loginModal = document.getElementById("login-modal");
const cerrarLogin = document.querySelector(".cerrar-login");

// Abrir modal
loginButton.addEventListener("click", () => {
  loginModal.style.display = "flex";
});

// Cerrar modal
cerrarLogin.addEventListener("click", () => {
  loginModal.style.display = "none";
});

// Cerrar al hacer clic fuera
window.addEventListener("click", (e) => {
  if (e.target === loginModal) {
    loginModal.style.display = "none";
  }
});

// Manejo de login
document.getElementById("login-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const datosLogin = new URLSearchParams({
    correo: document.getElementById('correo').value,
    password: document.getElementById('password').value
  });

  try {
    const resp = await fetch('php/login.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: datosLogin
    });
    
    const data = await resp.json();
    
    if (!data.success) {
      throw new Error(data.error || "Error en la autenticación");
    }

    sessionStorage.setItem('user_role', data.role);
    sessionStorage.setItem('user_email', data.correo);
    actualizarNav();
    window.location.href = data.redirect;

  } catch (err) {
    console.error('Error:', err);
    alert(err.message || "Error de conexión");
  }
});

// Manejo de registro
document.getElementById("registro-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const datosRegistro = new URLSearchParams({
    nombre: document.getElementById('reg-username').value,
    correo: document.getElementById('reg-email').value,
    password: document.getElementById('reg-password').value
  });

  try {
    const resp = await fetch('php/registro_vendedor.php', {
      method: 'POST',
      body: datosRegistro
    });

    if (resp.ok) {
      alert('Registro exitoso');
      loginModal.style.display = "none";
    } else {
      alert('Error en el registro');
    }
  } catch (err) {
    console.error('Error:', err);
    alert('Error de conexión');
  }
});

// -------------------- NAVEGACIÓN DINÁMICA --------------------
function actualizarNav() {
  const userRole = sessionStorage.getItem('user_role');
  const dynamicNavItem = document.getElementById('dynamic-nav-item');
  const navLink = document.getElementById('nav-link');

  if (userRole) {
    dynamicNavItem.style.display = 'block';
    navLink.textContent = userRole === 'seller' ? 'Modo Vendedor' : 'Pedidos Anteriores';
    navLink.href = userRole === 'seller' ? 'vendedor.html' : 'pedidos-anteriores.html';
  } else {
    dynamicNavItem.style.display = 'none';
  }
}

// Inicializar al cargar
document.addEventListener("DOMContentLoaded", actualizarNav);

        // -------------------- CARRITO --------------------
        let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
        const cartButton = document.querySelector(".cart-button");
        const carritoModal = document.getElementById("carrito-modal");
        const cerrarCarrito = document.querySelector(".cerrar-carrito");
        const vaciarCarritoBtn = document.getElementById("vaciar-carrito");

        function actualizarCarrito() {
          const carritoItems = document.getElementById("carrito-items");
          const carritoTotal = document.getElementById("carrito-total");
          let total = 0;

          carritoItems.innerHTML = carrito
            .map((item, index) => {
              const precio = parseInt(item.precio.replace(/\D/g, "")) || 0;
              const accesorioPrecio =
                {
                  ninguno: 0,
                  oso: 10000,
                  globo: 5000,
                  chocolate: 7000,
                  corona: 8000,
                }[item.accesorio] || 0;

              const subtotal = (precio + accesorioPrecio) * item.cantidad;
              total += subtotal;

              return `
        <div class="carrito-item">
          <img src="${item.imagen}" alt="${item.nombre}">
          <div>
            <h3>${item.nombre}</h3>
            <p>Cantidad: ${item.cantidad}</p>
            ${item.mensaje ? `<p>Mensaje: ${item.mensaje}</p>` : ""}
            ${
              item.accesorio !== "ninguno"
                ? `<p>Accesorio: ${item.accesorio}</p>`
                : ""
            }
            <p>Subtotal: $${subtotal.toLocaleString()}</p>
            <button class="eliminar-item" data-index="${index}">Eliminar</button>
          </div>
        </div>
      `;
            })
            .join("");

          carritoTotal.textContent = total.toLocaleString();
          localStorage.setItem("carrito", JSON.stringify(carrito));
          cartButton.setAttribute("data-count", carrito.length);
          cartButton.style.backgroundColor =
            carrito.length > 0 ? "#8cbaa3" : "#a8d5ba";
        }
        cartButton.addEventListener("click", () => {
          carritoModal.style.display = "block";
          actualizarCarrito();
        });

        cerrarCarrito.addEventListener(
          "click",
          () => (carritoModal.style.display = "none")
        );
        document.addEventListener("click", (e) => {
          if (e.target.classList.contains("eliminar-item")) {
            carrito.splice(e.target.dataset.index, 1);
            actualizarCarrito();
          }
        });

        vaciarCarritoBtn.addEventListener("click", () => {
          carrito = [];
          actualizarCarrito();
        });

        document.getElementById("agregar-carrito").addEventListener("click", () => {
            const nuevoItem = {
              ...datosFlores[currentFlowerIndex],
              cantidad: parseInt(document.getElementById("cantidad").value),
              mensaje: document.getElementById("mensaje-flor").value,
              accesorio: document.getElementById("accesorios").value,
            };

            carrito.push(nuevoItem);
            document.getElementById("confirmacion-agregado").style.display =
              "block";
            setTimeout(
              () =>
                (document.getElementById(
                  "confirmacion-agregado"
                ).style.display = "none"),
              2000
            );
            actualizarCarrito();
            modal.style.display = "none";
          });
        actualizarCarrito();
      });
    </script>
  </body>
</html>
