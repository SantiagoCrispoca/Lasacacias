<!DOCTYPE html>
<html lang="es">

<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <meta charset="UTF-8" />
  <meta name="author"
    content="David Santiago Crispoca Taborda, Sebastian Guzman Castiblanco, Yoann Esteban Jacome Garcia, Maria Alejandra Suarez Cuesta.">
  <meta name="description"
    content="Proyecto Tecnologías del internet MUL B 2025-01, pagina web creada con HTML, CSS Y JavaScript.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Productos - Floristería Las Acacias</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Header -->
  <header class="header">
    <button class="cart-button">🛒</button>
    <button class="login-button">👤</button> 
    <button class="logout-button" style="display:none;">Cerrar Sesión</button>
    <div class="logo">
      <a href="index.html">
        <img src="imagenes/logo2.jpg" alt="Logo de Floristería Las Acacias" />
      </a>
    </div>
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Buscar productos..." />
      <div id="search-results" class="search-results"></div>
    </div>
  </header>
  <!-- Navegación -->
  <nav class="navbar">
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="productos.html">Productos</a></li>
      <li><a href="quienes-somos.html">¿Quiénes Somos?</a></li>
      <li><a href="preguntas-frecuentes.html">Preguntas Frecuentes</a></li>
      <li id="dynamic-nav-item" style="display: none;">
        <a id="nav-link" href="#"></a>
      </li>
    </ul>
  </nav>

  <!-- Sección de Manojos -->
  <section class="productos-section">
    <h2>Manojos</h2>
    <div class="productos-grid">
      <div class="flor-clickeable">
        <img src="imagenes/manojo-1.jpeg" alt="Manojo 1" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-2.jpeg" alt="Manojo 2" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-3.jpeg" alt="Manojo 3" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-4.jpeg" alt="Manojo 4" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-5.jpeg" alt="Manojo 5" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-6.jpeg" alt="Manojo 6" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-7.jpg" alt="Manojo 7" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/manojo-8.jpg" alt="Manojo 8" />
      </div>
    </div>
  </section>

  <!-- Sección de Ramos -->
  <section class="productos-section">
    <h2>Ramos</h2>
    <div class="productos-grid">
      <div class="flor-clickeable">
        <img src="imagenes/ramo-1.jpeg" alt="Ramo 1" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-2.png" alt="Ramo 2" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-3.jpg" alt="Ramo 3" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-4.jpg" alt="Ramo 4" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-5.jpg" alt="Ramo 5" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-6.jpg" alt="Ramo 6" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-7.jpg" alt="Ramo 7" />
      </div>
      <div class="flor-clickeable">
        <img src="imagenes/ramo-8.jpg" alt="Ramo 8" />
      </div>
    </div>
  </section>

  <!-- Sección de Productos Agregados por Vendedores -->
  <section class="productos-section">
    <h2>Productos Nuevos</h2>
    <div class="productos-grid" id="productos-dinamicos">
      <!-- Aquí se insertan dinámicamente los productos desde la base de datos -->
    </div>
  </section>

  <!--Modales de flores-->
  <div id="modal" class="modal">
    <div class="modal-contenido">
      <span class="cerrar-modal">&times;</span>

      <h2 id="modal-titulo">Nombre de la Flor</h2>
      <img id="modal-imagen" src="" alt="Flor" class="modal-imagen" />
      <p id="modal-descripcion">Descripción de la flor.</p>
      <p id="modal-precio">Precio: $XX.XXX</p>

      <div class="cantidad-agregar">
        <label for="cantidad">Cantidad:</label>
        <input type="number" id="cantidad" min="1" value="1" />
        <button id="agregar-carrito">Agregar al carrito</button>
      </div>

      <div class="mensaje">
        <label for="mensaje-flor">Mensaje para la flor:</label>
        <textarea id="mensaje-flor" rows="4" placeholder="Escribe tu mensaje aquí..."></textarea>
      </div>

      <div class="accesorios">
        <label>Accesorios:</label>
        <select id="accesorios">
          <option value="ninguno">Ninguno</option>
          <option value="oso">Oso de peluche (+$10.000)</option>
          <option value="globo">Globo temático (+$5.000)</option>
          <option value="chocolate">Chocolate (+$7.000)</option>
          <option value="corona">Corona (+$8.000)</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Carrito de compras -->
  <div id="carrito-modal" class="carrito-modal">
    <div class="carrito-header">
      <h2>Tu Carrito</h2>
      <span class="cerrar-carrito">&times;</span>
    </div>
    <div id="carrito-items"></div>
    <div class="carrito-total">Total: $<span id="carrito-total">0</span></div>
    <div class="carrito-botones">
      <a href="pagos.html" class="pagar-carrito">Ir a pagar</a>
      <button class="vaciar-carrito" id="vaciar-carrito">
        Vaciar Carrito
      </button>
    </div>
  </div>

  <div class="confirmacion-agregado" id="confirmacion-agregado">
    Producto añadido al carrito!
  </div>

  <!-- Modal de Login -->
  <div id="login-modal" class="modal">
    <div class="modal-contenido">
      <span class="cerrar-login">&times;</span>
      <div class="login-tabs">
        <button class="tab-link active" data-tab="login">Iniciar Sesión</button>
        <button class="tab-link" data-tab="registro">Registrarse</button>
      </div>

      <!-- Formulario de Login -->
      <div id="login" class="tab-content active">
        <form id="login-form">
          <div class="form-group">
            <label for="username">Correo:</label>
            <input type="text" id="correo" name="correo" required>
          </div>
          <div class="form-group">
            <label for="password">Contraseña:</label>
            <input type="password" id="password" name="password" required>
          </div>
          <button type="submit" class="login-submit">Ingresar</button>
        </form>
      </div>

      <!-- Formulario de Registro Vendedor -->
      <div id="registro" class="tab-content">
        <form id="registro-form">
          <div class="form-group">
            <label for="reg-username">Nombre:</label>
            <input type="text" id="reg-username" required>
          </div>
          <div class="form-group">
            <label for="reg-password">Contraseña:</label>
            <input type="password" id="reg-password" required>
          </div>
          <div class="form-group">
            <label for="reg-email">Correo:</label>
            <input type="email" id="reg-email" required>
          </div>
          <button type="submit" class="login-submit">Registrarse como Vendedor</button>
        </form>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h3>Contáctanos</h3>
        <p><i class="fab fa-whatsapp"></i> +57 321 9694834</p>
        <p><i class="fa-solid fa-envelope"></i> lasacaciasfloristeria@gmail.com</p>
      </div>
      <div class="footer-section">
        <h3>Formas de pago</h3>
        <img src="imagenes/NequiLogo.png" alt="Nequi" style="width: 60px" />
      </div>
      <div class="footer-section">
        <h3>Redes</h3>
        <p>
          <a href="https://www.facebook.com/share/1Ahi9w2jai/" target="_blank" rel="noopener noreferrer">
            <img src="imagenes/Facebook.png" alt="Facebook" class="social-btn" />
          </a>
          <a href="https://www.instagram.com/lasacaciasflores/" target="_blank" rel="noopener noreferrer">
            <img src="imagenes/instagram.png" alt="Instagram" class="social-btn" />
          </a>
        </p>
      </div>
    </div>
    <div class="footer-copy">
      <p>© 2025 Floristería Las Acacias</p>
    </div>
  </footer>


  <!--Script interno-->
  <script>

    document.addEventListener("DOMContentLoaded", () => {
        const loginBtn = document.querySelector(".login-button");
        const logoutBtn = document.querySelector(".logout-button");
        const loginModal = document.getElementById("login-modal");

        // Detectar estado de sesión
        const userEmail = sessionStorage.getItem("user_email");

        if (userEmail) {
          // Usuario logueado
          loginBtn.style.display = "none";
          logoutBtn.style.display = "inline-block";
        } else {
          // Usuario no logueado
          loginBtn.style.display = "inline-block";
          logoutBtn.style.display = "none";
        }

        // Abrir modal login
        loginBtn.addEventListener("click", () => {
          if (loginModal) {
            loginModal.style.display = "flex";
          }
        });

        // Cerrar sesión
        logoutBtn.addEventListener("click", () => {
          sessionStorage.removeItem("user_email");
          sessionStorage.removeItem("user_role"); // si usas rol
          // Limpiar otras variables si hay
          window.location.reload();
        });

        // Cerrar modal login al clicar en "x"
        const cerrarLogin = document.querySelector(".cerrar-login");
        cerrarLogin.addEventListener("click", () => {
          loginModal.style.display = "none";
        });

        // Cerrar modal login al clicar fuera del contenido
        window.addEventListener("click", (e) => {
          if (e.target === loginModal) {
            loginModal.style.display = "none";
          }
        });
      });
    document.addEventListener("DOMContentLoaded", () => {
      // -------------------- COOKIES --------------------
      const cookieNotice = document.getElementById("cookie-notice");
      const acceptCookiesButton = document.getElementById("accept-cookies");
      if (acceptCookiesButton) {
        acceptCookiesButton.addEventListener("click", () => {
          cookieNotice.style.display = "none";
          localStorage.setItem("cookiesAccepted", "true");
        });
        if (localStorage.getItem("cookiesAccepted") === "true") {
          cookieNotice.style.display = "none";
        }
      }

      // -------------------- DATOS FLORES --------------------
      const datosFlores = [
        // Manojos
        {
          nombre: "Manojo Rosas Rojas",
          imagen: "imagenes/manojo-1.jpeg",
          descripcion:
            "Un hermoso manojo de Rosas rojas, perfecto para cualquier ocasión.",
          precio: "$60.000",
        },
        {
          nombre: "Manojo Variado",
          imagen: "imagenes/manojo-2.jpeg",
          descripcion:
            "Manojo de Rosas variadas, ideal para expresar amor y pureza.",
          precio: "$30.000",
        },
        {
          nombre: "Manojo De Girasoles",
          imagen: "imagenes/manojo-3.jpeg",
          descripcion: "Manojo de girasoles, lleno de energía y alegría.",
          precio: "$40.000",
        },
        {
          nombre: "Manojo Variado",
          imagen: "imagenes/manojo-4.jpeg",
          descripcion: "Manojo de liliums, elegante y sofisticado.",
          precio: "$25.000",
        },
        {
          nombre: "Manojo Variado rosado",
          imagen: "imagenes/manojo-5.jpeg",
          descripcion: "Manojo de margaritas, fresco y juvenil.",
          precio: "$25.000",
        },
        {
          nombre: "Manojo Variado amarillo",
          imagen: "imagenes/manojo-6.jpeg",
          descripcion: "Manojo de claveles, clásico y duradero.",
          precio: "$30.000",
        },
        {
          nombre: "Manojo Princesa",
          imagen: "imagenes/manojo-7.jpg",
          descripcion:
            "Manojo de rosas rojas, llamativo, perfecto para las princesas de la casa.",
          precio: "$120.000",
        },
        {
          nombre: "Manojo Girasoles",
          imagen: "imagenes/manojo-8.jpg",
          descripcion: "Manojo de girasoles, natural y encantador.",
          precio: "$40.000",
        },
        // Ramos
        {
          nombre: "Ramo Rosas Rojas",
          imagen: "imagenes/ramo-1.jpeg",
          descripcion: "Ramo de rosas rojas, el clásico símbolo del amor.",
          precio: "$80.000",
        },
        {
          nombre: "Ramo Rosas Rojas",
          imagen: "imagenes/ramo-2.png",
          descripcion:
            "Ramo de rosas rojas en base de vidrio, perfecto para alegrar cualquier espacio.",
          precio: "$40.000",
        },
        {
          nombre: "Ramo Variado Rosado",
          imagen: "imagenes/ramo-3.jpg",
          descripcion: "Ramo margaritas y girasoles, elegante y sofisticado.",
          precio: "$80.000",
        },
        {
          nombre: "Ramo Girasoles y Rosas",
          imagen: "imagenes/ramo-4.jpg",
          descripcion:
            "Ramo de girasoles y rosas rojas, lleno de energía y frescura.",
          precio: "$70.000",
        },
        {
          nombre: "Ramo Girasoles",
          imagen: "imagenes/ramo-5.jpg",
          descripcion:
            "Ramo de girasoles en base de vidrio, exótico y llamativo.",
          precio: "$30.000",
        },
        {
          nombre: "Ramo Variado",
          imagen: "imagenes/ramo-6.jpg",
          descripcion:
            "Ramo de girasoles y flores silvestres, natural y encantador.",
          precio: "$80.000",
        },
        {
          nombre: "Ramo Rosas Rosadas",
          imagen: "imagenes/ramo-7.jpg",
          descripcion:
            "Ramo de rosas rosadas, ideal para bodas y eventos especiales.",
          precio: "$50.000",
        },
        {
          nombre: "Ramo Exotico",
          imagen: "imagenes/ramo-8.jpg",
          descripcion:
            "Ramo de flores variadas, perfecto para cualquier ocasión.",
          precio: "$60.000",
        },
      ];

      const productos = [
        // Manojos
        {
          id: "manojo-1",
          nombre: "Manojo de Lavanda",
          imagen: "imagenes/manojo-1.jpeg",
        },
        {
          id: "manojo-2",
          nombre: "Manojo de Romero",
          imagen: "imagenes/manojo-2.jpeg",
        },
        {
          id: "manojo-3",
          nombre: "Manojo de Eucalipto",
          imagen: "imagenes/manojo-3.jpeg",
        },
        {
          id: "manojo-4",
          nombre: "Manojo de Hierbabuena",
          imagen: "imagenes/manojo-4.jpeg",
        },
        {
          id: "manojo-5",
          nombre: "Manojo de Albahaca",
          imagen: "imagenes/manojo-5.jpeg",
        },
        {
          id: "manojo-6",
          nombre: "Manojo de Cilantro",
          imagen: "imagenes/manojo-6.jpeg",
        },
        {
          id: "manojo-7",
          nombre: "Manojo de Tomillo",
          imagen: "imagenes/manojo-7.jpg",
        },
        {
          id: "manojo-8",
          nombre: "Manojo de Menta",
          imagen: "imagenes/manojo-8.jpg",
        },

        // Ramos
        {
          id: "ramo-1",
          nombre: "Ramo de Rosas Clásicas",
          imagen: "imagenes/ramo-1.jpeg",
        },
        {
          id: "ramo-2",
          nombre: "Ramo de Tulipanes",
          imagen: "imagenes/ramo-2.png",
        },
        {
          id: "ramo-3",
          nombre: "Ramo de Lirios",
          imagen: "imagenes/ramo-3.jpg",
        },
        {
          id: "ramo-4",
          nombre: "Ramo de Girasoles",
          imagen: "imagenes/ramo-4.jpg",
        },
        {
          id: "ramo-5",
          nombre: "Ramo de Margaritas",
          imagen: "imagenes/ramo-5.jpg",
        },
        {
          id: "ramo-6",
          nombre: "Ramo de Claveles",
          imagen: "imagenes/ramo-6.jpg",
        },
        {
          id: "ramo-7",
          nombre: "Ramo de Peonias",
          imagen: "imagenes/ramo-7.jpg",
        },
        {
          id: "ramo-8",
          nombre: "Ramo de Orquídeas",
          imagen: "imagenes/ramo-8.jpg",
        },
      ];


      //Nombre en blur
      document.querySelectorAll(".flor-clickeable").forEach((flor) => {
        const img = flor.querySelector("img");
        const imgSrc = img.getAttribute("src");
        const florData = datosFlores.find(item => item.imagen === imgSrc);

        if (florData) {
          const contenedorInfo = document.createElement("div");
          contenedorInfo.className = "nombre-flor";

          const nombreElement = document.createElement("div");
          nombreElement.className = "nombre-flor-texto";
          nombreElement.textContent = florData.nombre;

          const precioElement = document.createElement("div");
          precioElement.className = "precio-flor-texto";
          precioElement.textContent = florData.precio;

          contenedorInfo.appendChild(nombreElement);
          contenedorInfo.appendChild(precioElement);
          flor.appendChild(contenedorInfo);
        }
      });

      // -------------------- MODAL --------------------
      const modal = document.getElementById("modal");
      const modalTitulo = document.getElementById("modal-titulo");
      const modalImagen = document.getElementById("modal-imagen");
      const modalDescripcion = document.getElementById("modal-descripcion");
      const modalPrecio = document.getElementById("modal-precio");
      const cerrarModal = document.querySelector(".cerrar-modal");
      let currentFlowerIndex = 0;

      document.querySelectorAll(".flor-clickeable").forEach((flor) => {
        flor.addEventListener("click", () => {
          const imgSrc = flor.querySelector("img").getAttribute("src");
          const producto = datosFlores.find((item) => item.imagen === imgSrc);

          if (producto) {
            currentFlowerIndex = datosFlores.indexOf(producto);
            abrirModal(producto);
          }
        });
      });

      function abrirModal(producto) {
        productoActual = producto;
        modalTitulo.textContent = producto.nombre;
        modalImagen.src = producto.imagen;
        modalDescripcion.textContent = producto.descripcion;
        modalPrecio.textContent = `Precio: ${producto.precio}`;
        modal.style.display = "flex";
      }

      cerrarModal.addEventListener(
        "click",
        () => (modal.style.display = "none")
      );
      window.addEventListener(
        "click",
        (e) => e.target === modal && (modal.style.display = "none")
      );

      // -------------------- BÚSQUEDA ACTUALIZADA CON BASE DE DATOS --------------------
      const searchInput = document.getElementById("search-input");
      const searchResults = document.getElementById("search-results");

      searchInput.addEventListener("input", async function () {
        const query = this.value.trim();
        searchResults.innerHTML = "";

        if (!query) {
          searchResults.style.display = "none";
          return;
        }

        try {
          const resp = await fetch(`php/buscar_productos.php?q=${encodeURIComponent(query)}`);
          const data = await resp.json();

          if (!data.success) throw new Error(data.error);

          const resultados = data.productos;

          if (resultados.length === 0) {
            searchResults.innerHTML = "<div class='resultado-busqueda'>Sin resultados</div>";
          } else {
            searchResults.innerHTML = resultados.map(p => `
        <div class="resultado-busqueda" data-id="${p.id}">
          <img src="${p.imagen}" alt="${p.nombre}" width="40">
          <span>${p.nombre}</span>
        </div>
      `).join("");
          }

          searchResults.style.display = "block";

          // Abrir modal al hacer clic
          document.querySelectorAll(".resultado-busqueda").forEach(item => {
            item.addEventListener("click", () => {
              const id = item.getAttribute("data-id");
              const producto = resultados.find(p => p.id == id);
              abrirModalBD(producto);
            });
          });

        } catch (err) {
          searchResults.innerHTML = `<div class='resultado-busqueda'>Error: ${err.message}</div>`;
          searchResults.style.display = "block";
        }
      });

      // Mostrar producto desde base de datos
      function abrirModalBD(producto) {
        if (!producto) return;

        document.getElementById("modal-titulo").textContent = producto.nombre;
        document.getElementById("modal-imagen").src = producto.imagen;
        document.getElementById("modal-descripcion").textContent = producto.descripcion;
        document.getElementById("modal-precio").textContent = `Precio: $${parseInt(producto.precio).toLocaleString()}`;
        modal.style.display = "flex";

        // Actualiza currentFlowerIndex para que el carrito lo reconozca
        currentFlowerIndex = -1;
        datosFlores[-1] = {
          nombre: producto.nombre,
          imagen: producto.imagen,
          descripcion: producto.descripcion,
          precio: `$${parseInt(producto.precio).toLocaleString()}`
        };
      }

      // -------------------- LOGIN --------------------
      const loginButton = document.querySelector(".login-button");
      const loginModal = document.getElementById("login-modal");
      const cerrarLogin = document.querySelector(".cerrar-login");

      loginButton.addEventListener("click", () => {
        loginModal.style.display = "flex";
      });

      cerrarLogin.addEventListener("click", () => {
        loginModal.style.display = "none";
      });

      window.addEventListener("click", (e) => {
        if (e.target === loginModal) {
          loginModal.style.display = "none";
        }
      });

      document.getElementById("login-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const datosLogin = new URLSearchParams({
          correo: document.getElementById("correo").value,
          password: document.getElementById("password").value,
        });

        try {
          const resp = await fetch("php/login.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: datosLogin,
          });

          const data = await resp.json();

          if (!data.success) {
            throw new Error(data.error || "Error en la autenticación");
          }

          sessionStorage.setItem("user_role", data.role);
          sessionStorage.setItem("user_email", data.correo);
          window.location.href = data.redirect;
        } catch (err) {
          console.error("Error:", err);
          alert(err.message || "Error de conexión");
          window.location.reload();
        }
      });

      document.querySelectorAll(".tab-link").forEach((button) => {
        button.addEventListener("click", () => {
          const tab = button.dataset.tab;
          document.querySelectorAll(".tab-link, .tab-content").forEach((el) => {
            el.classList.remove("active");
          });
          button.classList.add("active");
          document.getElementById(tab).classList.add("active");
        });
      });

      document.getElementById("registro-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const datosRegistro = new URLSearchParams({
          nombre: document.getElementById("reg-username").value,
          correo: document.getElementById("reg-email").value,
          password: document.getElementById("reg-password").value,
        });

        try {
          const resp = await fetch("php/registro_vendedor.php", {
            method: "POST",
            body: datosRegistro,
          });

          if (resp.ok) {
            alert("Registro exitoso");
            document.getElementById("registro-form").reset();
            loginModal.style.display = "none";
          } else {
            alert("Hubo un problema al registrar. Intenta de nuevo.");
          }
        } catch (err) {
          console.error("Error de red:", err);
          alert("No se pudo conectar con el servidor.");
        }
      });


      // -------------------- NAVEGACIÓN DINÁMICA --------------------
      function actualizarNavegacionDinamica() {
        const role = sessionStorage.getItem('user_role') || localStorage.getItem('user_role');
        const navItem = document.getElementById("dynamic-nav-item");
        const navLink = document.getElementById("nav-link");

        if (role === "seller") {
          navItem.style.display = "block";
          navLink.textContent = "Modo Vendedor";
          navLink.href = "vendedor.html";
        } else if (role === "user") {
          navItem.style.display = "block";
          navLink.textContent = "Pedidos Anteriores";
          navLink.href = "pedidos-anteriores.html";
        } else {
          navItem.style.display = "none";
        }
      }


      // Inicializar al cargar
      document.addEventListener("DOMContentLoaded", actualizarNavegacionDinamica);
      actualizarNavegacionDinamica();

      // -------------------- CARRITO --------------------
      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      const cartButton = document.querySelector(".cart-button");
      const carritoModal = document.getElementById("carrito-modal");
      const cerrarCarrito = document.querySelector(".cerrar-carrito");
      const vaciarCarritoBtn = document.getElementById("vaciar-carrito");

      function actualizarCarrito() {
        const carritoItems = document.getElementById("carrito-items");
        const carritoTotal = document.getElementById("carrito-total");
        let total = 0;

        carritoItems.innerHTML = carrito
          .map((item, index) => {
            const precio = parseInt(item.precio.replace(/\D/g, "")) || 0;
            const accesorioPrecio =
              {
                ninguno: 0,
                oso: 10000,
                globo: 5000,
                chocolate: 7000,
                corona: 8000,
              }[item.accesorio] || 0;

            const subtotal = (precio + accesorioPrecio) * item.cantidad;
            total += subtotal;

            return `
        <div class="carrito-item">
          <img src="${item.imagen}" alt="${item.nombre}">
          <div>
            <h3>${item.nombre}</h3>
            <p>Cantidad: ${item.cantidad}</p>
            ${item.mensaje ? `<p>Mensaje: ${item.mensaje}</p>` : ""}
            ${item.accesorio !== "ninguno"
                ? `<p>Accesorio: ${item.accesorio}</p>`
                : ""
              }
            <p>Subtotal: $${subtotal.toLocaleString()}</p>
            <button class="eliminar-item" data-index="${index}">Eliminar</button>
          </div>
        </div>
      `;
          })
          .join("");

        carritoTotal.textContent = total.toLocaleString();
        localStorage.setItem("carrito", JSON.stringify(carrito));
        cartButton.setAttribute("data-count", carrito.length);
        cartButton.style.backgroundColor =
          carrito.length > 0 ? "#8cbaa3" : "#a8d5ba";
      }
      cartButton.addEventListener("click", () => {
        carritoModal.style.display = "block";
        actualizarCarrito();
      });

      cerrarCarrito.addEventListener(
        "click",
        () => (carritoModal.style.display = "none")
      );
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("eliminar-item")) {
          carrito.splice(e.target.dataset.index, 1);
          actualizarCarrito();
        }
      });

      vaciarCarritoBtn.addEventListener("click", () => {
        carrito = [];
        actualizarCarrito();
      });

document.getElementById("agregar-carrito").addEventListener("click", () => {
  if (!productoActual) return; // seguridad

  const nuevoItem = {
    nombre: productoActual.nombre,
    imagen: productoActual.imagen,
    descripcion: productoActual.descripcion || "",
    precio: productoActual.precio || productoActual.precio_formateado || "$0",
    cantidad: parseInt(document.getElementById("cantidad").value) || 1,
    mensaje: document.getElementById("mensaje-flor").value || "",
    accesorio: document.getElementById("accesorios").value || "ninguno",
  };

  carrito.push(nuevoItem);

  document.getElementById("confirmacion-agregado").style.display = "block";
  setTimeout(() => {
    document.getElementById("confirmacion-agregado").style.display = "none";
  }, 2000);

  actualizarCarrito();
  modal.style.display = "none";
});

      async function cargarProductosDesdeBD() {
        try {
          const resp = await fetch('php/obtener_productos.php');
          const data = await resp.json();
          const contenedor = document.getElementById('productos-dinamicos');

          if (!data.success) throw new Error(data.error);

          data.productos.forEach(producto => {
            const div = document.createElement('div');
            div.className = 'flor-clickeable';
            div.innerHTML = `
        <img src="${producto.imagen}" alt="${producto.nombre}" />
        <div class="nombre-flor">
          <div class="nombre-flor-texto">${producto.nombre}</div>
          <div class="precio-flor-texto">$${parseInt(producto.precio).toLocaleString()}</div>
        </div>
      `;

            div.addEventListener('click', () => {
              abrirModal({
                nombre: producto.nombre,
                imagen: producto.imagen,
                descripcion: producto.descripcion,
                precio: `$${parseInt(producto.precio).toLocaleString()}`
              });
            });

            contenedor.appendChild(div);
          });

        } catch (err) {
          console.error('Error cargando productos:', err);
        }
      }

      actualizarCarrito();
      cargarProductosDesdeBD();

    });
  </script>
</body>

</html>